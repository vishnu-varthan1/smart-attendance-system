{% extends "base.html" %}

{% block title %}Dashboard - Smart Attendance System{% endblock %}

{% block content %}
<!-- ðŸŽ¨ PREMIUM DASHBOARD HEADER -->
<div class="row mb-5">
    <div class="col-12 text-center">
        <div class="fade-in-up">
            <h1 class="display-4 gradient-text mb-3 floating">
                <i class="fas fa-tachometer-alt me-3"></i>Smart Dashboard
            </h1>
            <p class="lead text-white-50 mb-4">Real-time attendance monitoring with AI-powered face recognition</p>
            <div class="d-flex justify-content-center gap-3">
                <span class="badge bg-success pulse-animation">
                    <i class="fas fa-robot me-1"></i>AI Powered
                </span>
                <span class="badge bg-primary pulse-animation">
                    <i class="fas fa-eye me-1"></i>Real-time
                </span>
                <span class="badge bg-warning pulse-animation">
                    <i class="fas fa-shield-alt me-1"></i>Secure
                </span>
            </div>
        </div>
    </div>
</div>

<!-- ðŸŽ¨ PREMIUM STATISTICS CARDS WITH ANIMATED COUNTERS -->
<div class="row mb-5" id="statisticsCards">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card glass hover-lift hover-glow-primary fade-in-up stagger-1">
            <div class="card-body text-center p-4 position-relative overflow-hidden">
                <!-- Animated Background Glow -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10">
                    <div class="w-100 h-100 bg-primary-gradient pulse"></div>
                </div>
                
                <div class="position-relative">
                    <div class="mb-3">
                        <div class="icon-container icon-container-gradient-primary hover-scale-lg pulse-glow" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-users fa-2x text-white"></i>
                        </div>
                    </div>
                    <h2 class="display-6 fw-bold text-gradient-primary mb-2 counter-animate" 
                        data-target="{{ total_students }}" data-suffix="">0</h2>
                    <p class="text-muted mb-0 fw-semibold">Total Students</p>
                    <div class="mt-3">
                        <span class="badge badge-gradient-primary pulse">
                            <i class="fas fa-arrow-up me-1"></i>Active
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card glass hover-lift hover-glow-success fade-in-up stagger-2">
            <div class="card-body text-center p-4 position-relative overflow-hidden">
                <!-- Animated Background Glow -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10">
                    <div class="w-100 h-100 bg-success-gradient pulse"></div>
                </div>
                
                <div class="position-relative">
                    <div class="mb-3">
                        <div class="icon-container icon-container-gradient-success hover-scale-lg pulse-glow" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-check-circle fa-2x text-white"></i>
                        </div>
                    </div>
                    <h2 class="display-6 fw-bold text-gradient-success mb-2 counter-animate" 
                        data-target="{{ today_attendance }}" data-suffix="">0</h2>
                    <p class="text-muted mb-0 fw-semibold">Today's Present</p>
                    <div class="mt-3">
                        <span class="badge badge-gradient-success pulse">
                            <i class="fas fa-calendar-check me-1"></i>Today
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card glass hover-lift hover-glow-warning fade-in-up stagger-3">
            <div class="card-body text-center p-4 position-relative overflow-hidden">
                <!-- Animated Background Glow -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10">
                    <div class="w-100 h-100 bg-warning-gradient pulse"></div>
                </div>
                
                <div class="position-relative">
                    <div class="mb-3">
                        <div class="icon-container icon-container-gradient-warning hover-scale-lg pulse-glow" 
                             style="width: 80px; height: 80px; background: var(--warning-gradient);">
                            <i class="fas fa-percentage fa-2x text-white"></i>
                        </div>
                    </div>
                    <h2 class="display-6 fw-bold text-gradient-warning mb-2 counter-animate" 
                        id="attendance-percentage" data-target="0" data-suffix="%">0%</h2>
                    <p class="text-muted mb-0 fw-semibold">Attendance Rate</p>
                    <div class="mt-3">
                        <span class="badge badge-gradient-warning pulse">
                            <i class="fas fa-chart-line me-1"></i>Live
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card glass hover-lift hover-glow-danger fade-in-up stagger-4">
            <div class="card-body text-center p-4 position-relative overflow-hidden">
                <!-- Animated Background Glow -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10">
                    <div class="w-100 h-100 bg-danger-gradient pulse"></div>
                </div>
                
                <div class="position-relative">
                    <div class="mb-3">
                        <div class="icon-container icon-container-gradient-danger hover-scale-lg pulse-glow" 
                             style="width: 80px; height: 80px; background: var(--danger-gradient);">
                            <i class="fas fa-calendar fa-2x text-white"></i>
                        </div>
                    </div>
                    <h2 class="display-6 fw-bold text-gradient-danger mb-2 counter-animate" 
                        data-target="{{ datetime.now().strftime('%d') }}" data-suffix="">0</h2>
                    <p class="text-muted mb-0 fw-semibold">{{ datetime.now().strftime('%B %Y') }}</p>
                    <div class="mt-3">
                        <span class="badge badge-gradient-danger pulse">
                            <i class="fas fa-clock me-1"></i>{{ datetime.now().strftime('%H:%M') }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ðŸš€ ENHANCED QUICK ACTIONS SECTION -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card glass fade-in-up stagger-5">
            <div class="card-header glass-dark border-0 position-relative overflow-hidden">
                <!-- Animated Header Background -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-5">
                    <div class="w-100 h-100 bg-primary-gradient"></div>
                </div>
                
                <div class="position-relative">
                    <h5 class="mb-0 text-gradient-primary fw-bold">
                        <i class="fas fa-bolt me-2 icon-gradient-primary"></i>Quick Actions
                    </h5>
                    <small class="text-muted">Streamline your workflow with one-click actions</small>
                </div>
            </div>
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="{{ url_for('register_student') }}" 
                           class="btn btn-gradient-primary btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center p-4 text-decoration-none hover-lift position-relative overflow-hidden">
                            <!-- Button Glow Effect -->
                            <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0 hover-opacity-20 transition-all">
                                <div class="w-100 h-100 bg-white"></div>
                            </div>
                            
                            <div class="position-relative text-center">
                                <div class="icon-container mb-3 bg-white bg-opacity-20 hover-scale">
                                    <i class="fas fa-user-plus fa-2x text-white"></i>
                                </div>
                                <h6 class="fw-bold mb-1 text-white">Register Student</h6>
                                <small class="text-white-50">Add new students to system</small>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="{{ url_for('mark_attendance') }}" 
                           class="btn btn-gradient-success btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center p-4 text-decoration-none hover-lift position-relative overflow-hidden">
                            <!-- Button Glow Effect -->
                            <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0 hover-opacity-20 transition-all">
                                <div class="w-100 h-100 bg-white"></div>
                            </div>
                            
                            <div class="position-relative text-center">
                                <div class="icon-container mb-3 bg-white bg-opacity-20 hover-scale">
                                    <i class="fas fa-camera fa-2x text-white"></i>
                                </div>
                                <h6 class="fw-bold mb-1 text-white">Mark Attendance</h6>
                                <small class="text-white-50">AI-powered face recognition</small>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="{{ url_for('attendance') }}" 
                           class="btn btn-gradient-warning btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center p-4 text-decoration-none hover-lift position-relative overflow-hidden">
                            <!-- Button Glow Effect -->
                            <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0 hover-opacity-20 transition-all">
                                <div class="w-100 h-100 bg-white"></div>
                            </div>
                            
                            <div class="position-relative text-center">
                                <div class="icon-container mb-3 bg-white bg-opacity-20 hover-scale">
                                    <i class="fas fa-list fa-2x text-white"></i>
                                </div>
                                <h6 class="fw-bold mb-1 text-white">View Records</h6>
                                <small class="text-white-50">Browse attendance history</small>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="{{ url_for('reports') }}" 
                           class="btn btn-gradient-danger btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center p-4 text-decoration-none hover-lift position-relative overflow-hidden">
                            <!-- Button Glow Effect -->
                            <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0 hover-opacity-20 transition-all">
                                <div class="w-100 h-100 bg-white"></div>
                            </div>
                            
                            <div class="position-relative text-center">
                                <div class="icon-container mb-3 bg-white bg-opacity-20 hover-scale">
                                    <i class="fas fa-chart-bar fa-2x text-white"></i>
                                </div>
                                <h6 class="fw-bold mb-1 text-white">Generate Report</h6>
                                <small class="text-white-50">Analytics and insights</small>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ðŸŽ¯ MODERN TIMELINE-STYLE RECENT ATTENDANCE SECTION -->
<div class="row">
    <div class="col-12">
        <div class="card glass fade-in-up stagger-6">
            <div class="card-header glass-dark border-0 d-flex justify-content-between align-items-center position-relative overflow-hidden">
                <!-- Animated Header Background -->
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-5">
                    <div class="w-100 h-100 bg-info-gradient"></div>
                </div>
                
                <div class="position-relative">
                    <h5 class="mb-0 text-gradient-primary fw-bold">
                        <i class="fas fa-history me-2 icon-gradient-primary"></i>Recent Activity Timeline
                    </h5>
                    <small class="text-muted">Live attendance feed with real-time updates</small>
                </div>
                
                <div class="d-flex gap-2">
                    <button class="btn btn-glass btn-sm hover-lift" id="refreshTimeline" title="Refresh Timeline">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <a href="{{ url_for('attendance') }}" class="btn btn-glass btn-sm hover-lift">
                        <i class="fas fa-external-link-alt me-1"></i>View All
                    </a>
                </div>
            </div>
            <div class="card-body p-4">
                {% if recent_records %}
                    <!-- Timeline Container -->
                    <div class="timeline-container position-relative">
                        <!-- Timeline Line -->
                        <div class="timeline-line position-absolute"></div>
                        
                        <!-- Timeline Items -->
                        <div class="timeline-items">
                            {% for record in recent_records %}
                            <div class="timeline-item fade-in-up stagger-{{ loop.index }}" 
                                 data-aos="fade-up" 
                                 data-aos-delay="{{ loop.index * 100 }}">
                                
                                <!-- Timeline Dot -->
                                <div class="timeline-dot position-absolute">
                                    {% if record.status == 'Present' %}
                                        <div class="timeline-dot-inner bg-success-gradient pulse-glow">
                                            <i class="fas fa-check text-white"></i>
                                        </div>
                                    {% elif record.status == 'Late' %}
                                        <div class="timeline-dot-inner bg-warning-gradient pulse-glow">
                                            <i class="fas fa-clock text-white"></i>
                                        </div>
                                    {% else %}
                                        <div class="timeline-dot-inner bg-danger-gradient pulse-glow">
                                            <i class="fas fa-times text-white"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Timeline Content Card -->
                                <div class="timeline-content glass-light hover-lift position-relative overflow-hidden">
                                    <!-- Card Glow Effect -->
                                    <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0 hover-opacity-10 transition-all">
                                        {% if record.status == 'Present' %}
                                            <div class="w-100 h-100 bg-success-gradient"></div>
                                        {% elif record.status == 'Late' %}
                                            <div class="w-100 h-100 bg-warning-gradient"></div>
                                        {% else %}
                                            <div class="w-100 h-100 bg-danger-gradient"></div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="position-relative p-3">
                                        <!-- Header Row -->
                                        <div class="row align-items-center mb-2">
                                            <div class="col-md-8">
                                                <div class="d-flex align-items-center">
                                                    <!-- Student Avatar -->
                                                    <div class="timeline-avatar me-3">
                                                        <div class="icon-container icon-container-glass">
                                                            <i class="fas fa-user text-gradient-primary"></i>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Student Info -->
                                                    <div>
                                                        <h6 class="mb-1 fw-bold text-gradient-primary">
                                                            {{ record.student.name if record.student else 'Unknown Student' }}
                                                        </h6>
                                                        <div class="d-flex align-items-center gap-2">
                                                            <span class="badge badge-glass">
                                                                <i class="fas fa-id-card me-1"></i>
                                                                {{ record.student.student_id if record.student else 'N/A' }}
                                                            </span>
                                                            {% if record.confidence_score %}
                                                                <span class="badge badge-gradient-primary">
                                                                    <i class="fas fa-brain me-1"></i>
                                                                    {{ "%.1f"|format(record.confidence_score) }}% AI
                                                                </span>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-4 text-md-end">
                                                <!-- Status Badge -->
                                                {% if record.status == 'Present' %}
                                                    <span class="badge badge-gradient-success pulse fs-6 px-3 py-2">
                                                        <i class="fas fa-check me-1"></i>{{ record.status }}
                                                    </span>
                                                {% elif record.status == 'Late' %}
                                                    <span class="badge badge-gradient-warning pulse fs-6 px-3 py-2">
                                                        <i class="fas fa-clock me-1"></i>{{ record.status }}
                                                    </span>
                                                {% else %}
                                                    <span class="badge badge-gradient-danger pulse fs-6 px-3 py-2">
                                                        <i class="fas fa-times me-1"></i>{{ record.status }}
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- Details Row -->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="d-flex align-items-center text-muted mb-1">
                                                    <i class="fas fa-calendar-alt me-2 text-gradient-primary"></i>
                                                    <small class="fw-medium">
                                                        {{ record.date.strftime('%B %d, %Y') if record.date else 'N/A' }}
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-flex align-items-center text-muted mb-1">
                                                    <i class="fas fa-clock me-2 text-gradient-primary"></i>
                                                    <small class="fw-medium">
                                                        {{ record.time_in.strftime('%I:%M %p') if record.time_in else 'N/A' }}
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Confidence Progress Bar (if available) -->
                                        {% if record.confidence_score %}
                                        <div class="mt-2">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small class="text-muted fw-medium">Recognition Confidence</small>
                                                <small class="fw-bold text-gradient-primary">{{ "%.1f"|format(record.confidence_score) }}%</small>
                                            </div>
                                            <div class="progress progress-glass" style="height: 6px;">
                                                <div class="progress-bar progress-bar-gradient-primary progress-bar-animated" 
                                                     style="width: {{ record.confidence_score }}%"
                                                     data-bs-toggle="tooltip" 
                                                     title="AI Recognition Confidence: {{ '%.1f'|format(record.confidence_score) }}%"></div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Timeline End Indicator -->
                        <div class="timeline-end text-center mt-4 fade-in-up">
                            <div class="timeline-end-dot mx-auto mb-2">
                                <i class="fas fa-flag text-gradient-primary"></i>
                            </div>
                            <small class="text-muted fw-medium">End of Recent Activity</small>
                        </div>
                    </div>
                {% else %}
                    <!-- Empty State with Enhanced Design -->
                    <div class="text-center py-5 fade-in-up">
                        <div class="empty-state-container">
                            <!-- Animated Empty State Icon -->
                            <div class="empty-state-icon mb-4 mx-auto">
                                <div class="icon-container icon-container-glass floating" style="width: 100px; height: 100px;">
                                    <i class="fas fa-history fa-3x text-muted"></i>
                                </div>
                                <!-- Floating Particles -->
                                <div class="empty-state-particles">
                                    <div class="particle particle-1"></div>
                                    <div class="particle particle-2"></div>
                                    <div class="particle particle-3"></div>
                                </div>
                            </div>
                            
                            <h5 class="text-gradient-primary mb-3 fw-bold">No Recent Activity</h5>
                            <p class="text-muted mb-4 lead">
                                Start marking attendance to see the timeline come to life with real-time updates
                            </p>
                            
                            <!-- Call to Action Buttons -->
                            <div class="d-flex justify-content-center gap-3 flex-wrap">
                                <a href="{{ url_for('mark_attendance') }}" class="btn btn-gradient-primary btn-lg hover-lift">
                                    <i class="fas fa-camera me-2"></i>Start Marking Attendance
                                </a>
                                <a href="{{ url_for('register_student') }}" class="btn btn-glass btn-lg hover-lift">
                                    <i class="fas fa-user-plus me-2"></i>Register Students
                                </a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // ðŸ”„ LOADING STATES INITIALIZATION
    function initializeLoadingStates() {
        // Show skeleton for statistics cards on page load
        if (window.performance && window.performance.navigation.type === 0) {
            // Only show skeleton on fresh page load, not on refresh
            showDashboardSkeleton();
            
            // Hide skeleton after content loads
            setTimeout(function() {
                hideDashboardSkeleton();
            }, 1500);
        }
        
        // Add loading states to quick action buttons
        $('.btn-gradient-primary, .btn-gradient-success, .btn-gradient-warning, .btn-gradient-danger').on('click', function(e) {
            const $button = $(this);
            const href = $button.attr('href');
            
            // Don't show loading for buttons without href or with # href
            if (!href || href === '#' || href.startsWith('javascript:')) {
                return;
            }
            
            e.preventDefault();
            
            // Show button loading state
            loadingStates.showButtonLoading(this, {
                text: 'Loading...'
            });
            
            // Navigate after short delay for visual feedback
            setTimeout(function() {
                window.location.href = href;
            }, 800);
        });
        
        // Add loading states to timeline refresh
        $('#refreshTimeline').on('click', function(e) {
            e.preventDefault();
            const $button = $(this);
            
            // Show button loading
            loadingStates.showButtonLoading(this, {
                text: 'Refreshing...'
            });
            
            // Show section loading for timeline
            loadingStates.showSectionLoading('#recentActivityTimeline', {
                message: 'Loading recent activity...'
            });
            
            // Simulate data loading
            setTimeout(function() {
                loadingStates.hideButtonLoading($button[0]);
                loadingStates.hideSectionLoading('#recentActivityTimeline');
                
                // Show success toast
                if (window.enhancedToast) {
                    enhancedToast.show('Timeline refreshed successfully!', 'success');
                }
            }, 2000);
        });
    }
    
    // ðŸŽ¨ DASHBOARD SKELETON FUNCTIONS
    function showDashboardSkeleton() {
        const skeletonHTML = `
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="skeleton-stat-card">
                    <div class="skeleton skeleton-stat-icon"></div>
                    <div class="skeleton skeleton-stat-value"></div>
                    <div class="skeleton skeleton-stat-label"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="skeleton-stat-card">
                    <div class="skeleton skeleton-stat-icon"></div>
                    <div class="skeleton skeleton-stat-value"></div>
                    <div class="skeleton skeleton-stat-label"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="skeleton-stat-card">
                    <div class="skeleton skeleton-stat-icon"></div>
                    <div class="skeleton skeleton-stat-value"></div>
                    <div class="skeleton skeleton-stat-label"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="skeleton-stat-card">
                    <div class="skeleton skeleton-stat-icon"></div>
                    <div class="skeleton skeleton-stat-value"></div>
                    <div class="skeleton skeleton-stat-label"></div>
                </div>
            </div>
        `;
        
        const $container = $('#statisticsCards');
        $container.data('original-content', $container.html());
        $container.html(skeletonHTML);
        $container.addClass('skeleton-container');
    }
    
    function hideDashboardSkeleton() {
        const $container = $('#statisticsCards');
        const originalContent = $container.data('original-content');
        
        if (originalContent) {
            $container.fadeOut(300, function() {
                $container.html(originalContent);
                $container.removeClass('skeleton-container');
                $container.fadeIn(300);
                
                // Re-initialize animations after content is restored
                initializeCounters();
                initializeHoverEffects();
            });
        }
    }
    
    // ðŸŽ¯ ANIMATED COUNTER FUNCTION
    function animateCounter(element, target, suffix = '', duration = 2000) {
        const $element = $(element);
        const startValue = 0;
        const increment = target / (duration / 16); // 60fps
        let currentValue = startValue;
        
        const timer = setInterval(function() {
            currentValue += increment;
            if (currentValue >= target) {
                currentValue = target;
                clearInterval(timer);
            }
            $element.text(Math.floor(currentValue) + suffix);
        }, 16);
    }
    
    // ðŸš€ INITIALIZE ANIMATED COUNTERS
    function initializeCounters() {
        $('.counter-animate').each(function() {
            const $this = $(this);
            const target = parseInt($this.data('target')) || 0;
            const suffix = $this.data('suffix') || '';
            
            // Add intersection observer for better performance
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateCounter(entry.target, target, suffix);
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            observer.observe(this);
        });
    }
    
    // ðŸ“Š LOAD ATTENDANCE SUMMARY WITH ANIMATION
    function loadAttendanceSummary() {
        $.get('/api/attendance_summary', function(data) {
            if (data.present_percentage !== undefined) {
                const $percentageElement = $('#attendance-percentage');
                $percentageElement.data('target', data.present_percentage);
                animateCounter($percentageElement[0], data.present_percentage, '%');
            }
        }).fail(function() {
            console.log('Failed to load attendance summary');
        });
    }
    
    // ðŸŽ¨ ENHANCED HOVER EFFECTS
    function initializeHoverEffects() {
        // Add dynamic glow effects to cards
        $('.card.glass').hover(
            function() {
                $(this).addClass('shadow-lg');
            },
            function() {
                $(this).removeClass('shadow-lg');
            }
        );
        
        // Add ripple effect to buttons
        $('.btn-gradient-primary, .btn-gradient-success, .btn-gradient-warning, .btn-gradient-danger').on('click', function(e) {
            const $button = $(this);
            const $ripple = $('<span class="ripple"></span>');
            
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            $ripple.css({
                width: size,
                height: size,
                left: x,
                top: y
            });
            
            $button.append($ripple);
            
            setTimeout(() => {
                $ripple.remove();
            }, 600);
        });
    }
    
    // ðŸ”„ REAL-TIME UPDATES
    function setupRealTimeUpdates() {
        // Update time every second
        setInterval(function() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit'
            });
            
            $('.badge-gradient-danger').each(function() {
                const $badge = $(this);
                if ($badge.find('.fa-clock').length > 0) {
                    $badge.html('<i class="fas fa-clock me-1"></i>' + timeString);
                }
            });
        }, 1000);
        
        // Auto-refresh data every 30 seconds
        setInterval(function() {
            loadAttendanceSummary();
        }, 30000);
    }
    
    // ðŸŽ¬ STAGGERED ANIMATIONS
    function initializeStaggeredAnimations() {
        // Add staggered animation delays to timeline items
        $('.timeline-item').each(function(index) {
            $(this).addClass('stagger-' + (index + 1));
        });
        
        // Initialize tooltips for progress bars
        $('[data-bs-toggle="tooltip"]').tooltip();
    }
    
    // ðŸ”„ TIMELINE REFRESH FUNCTIONALITY
    function initializeTimelineRefresh() {
        $('#refreshTimeline').on('click', function(e) {
            e.preventDefault();
            const $button = $(this);
            const $icon = $button.find('i');
            
            // Add refreshing state
            $button.addClass('refreshing').prop('disabled', true);
            $icon.removeClass('fa-sync-alt').addClass('fa-spinner fa-spin');
            
            // Simulate refresh (in real app, this would reload data)
            setTimeout(function() {
                // Remove refreshing state
                $button.removeClass('refreshing').prop('disabled', false);
                $icon.removeClass('fa-spinner fa-spin').addClass('fa-sync-alt');
                
                // Add success feedback
                $button.addClass('btn-gradient-success');
                setTimeout(function() {
                    $button.removeClass('btn-gradient-success');
                }, 1000);
                
                // Re-animate timeline items
                $('.timeline-item').each(function(index) {
                    const $item = $(this);
                    $item.css('animation', 'none');
                    setTimeout(function() {
                        $item.css('animation', '');
                        $item.addClass('fade-in-up');
                    }, index * 100);
                });
            }, 2000);
        });
    }
    
    // ðŸŽ¯ TIMELINE INTERACTIONS
    function initializeTimelineInteractions() {
        // Timeline item click effects
        $('.timeline-content').on('click', function() {
            const $this = $(this);
            
            // Add click ripple effect
            const $ripple = $('<div class="timeline-ripple"></div>');
            $this.append($ripple);
            
            setTimeout(function() {
                $ripple.remove();
            }, 600);
            
            // Highlight clicked item
            $('.timeline-content').removeClass('timeline-active');
            $this.addClass('timeline-active');
            
            setTimeout(function() {
                $this.removeClass('timeline-active');
            }, 2000);
        });
        
        // Enhanced hover effects for timeline dots
        $('.timeline-dot-inner').hover(
            function() {
                $(this).addClass('hover-scale-lg');
            },
            function() {
                $(this).removeClass('hover-scale-lg');
            }
        );
        
        // Smooth scroll to timeline items
        $('.timeline-item').each(function(index) {
            const $item = $(this);
            
            // Add intersection observer for scroll animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('timeline-item-enhanced');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '50px'
            });
            
            observer.observe(this);
        });
    }
    
    // ðŸš€ INITIALIZE ALL FEATURES
    initializeLoadingStates();
    initializeCounters();
    loadAttendanceSummary();
    initializeHoverEffects();
    setupRealTimeUpdates();
    initializeStaggeredAnimations();
    initializeTimelineRefresh();
    initializeTimelineInteractions();
    
    // ðŸŽ¯ PERFORMANCE OPTIMIZATION
    // Preload critical animations
    $('<style>')
        .prop('type', 'text/css')
        .html(`
            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: scale(0);
                animation: ripple-animation 0.6s linear;
                pointer-events: none;
            }
            
            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            
            .hover-opacity-20:hover {
                opacity: 0.2 !important;
            }
            
            .transition-all {
                transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            }
            
            .timeline-ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(102, 126, 234, 0.3);
                transform: scale(0);
                animation: timeline-ripple-animation 0.6s linear;
                pointer-events: none;
                top: 50%;
                left: 50%;
                width: 100px;
                height: 100px;
                margin-left: -50px;
                margin-top: -50px;
            }
            
            @keyframes timeline-ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            
            .timeline-active {
                border-color: rgba(102, 126, 234, 0.5) !important;
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.3) !important;
            }
        `)
        .appendTo('head');
});
</script>
{% endblock %}